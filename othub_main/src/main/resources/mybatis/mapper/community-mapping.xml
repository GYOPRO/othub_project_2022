<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="community.CommunityDAO" >

	<!-- 전체 게시물 조회 -->
	<select id="communityList" resultType="communitydto">
		select s_seq,s_title,s_contents,s_writer,s_viewcount,s_writingtime,
		 s_image1 as imagename1, s_image2 as imagename2, s_image2 as imagename2, s_like from styletab
	</select>

	<!-- 전체 게시물 갯수 조회 -->
	<select id="countCommunity" resultType="int">
		select count(*) from styletab
	</select>
	
	<!-- 페이징 최신순-->
	<select id="limitCommunity" resultType="communitydto" parameterType="int">
		select s_seq,s_title,s_contents,s_writer,s_viewcount,s_writingtime,
		 s_image1 as imagename1, s_image2 as imagename2, s_image2 as imagename2, s_like from styletab
		  order by s_seq desc limit #{limit}, 16
	</select>
	
		<!-- 페이징 좋아요순(다시)-->
	<select id="likeCommunity" resultType="communitydto" parameterType="int">
		select s_seq,s_title,s_contents,s_writer,s_viewcount,s_writingtime,
		 s_image1 as imagename1, s_image2 as imagename2, s_image2 as imagename2, s_like from styletab
		  order by s_like desc limit #{limit}, 16
	</select>
	
	<!-- 게시물 저장 -->
	<insert id="insertCommunity" parameterType="communitydto" >
		insert into styletab(s_title, s_contents, s_writer, s_image1, s_image2, s_image3)
		values(#{s_title}, #{s_contents}, #{s_writer}, #{imagename1},#{imagename2},#{imagename3})
	</insert>
	
	<!-- 좋아요 수 조회 -->
	<select id="likeCount" resultType="int">
		select s_like from styletab where s_seq=#{s_seq}
	</select>
	
	<!-- 게시물 디테일 -->
	<select id="oneCommunity" resultType="communitydto">
		select s_seq,s_title,s_contents,s_writer,s_viewcount,s_writingtime,
		 s_image1 as imagename1, s_image2 as imagename2, s_image3 as imagename3, s_like  from styletab where s_seq=#{s_seq}
	</select>
	
	<!-- 게시물 수정(제목, 내용, 날짜만) -->
	<update id="updateWriting">
		update styletab set s_title = #{s_title}, s_contents=#{s_contents} where s_seq=#{s_seq}
	</update>
	
	<!-- 조회수 업데이트 -->
	<update id="viewCount" parameterType="int">
		update styletab set s_viewcount=s_viewcount+1 where s_seq=#{s_seq}
	</update>
	
	<!-- 게시물 삭제 -->
	<delete id="deleteCommunity" >
		delete from styletab where s_seq=#{s_seq}
	</delete>
	
	<!-- 좋아요 중복방지 select -->
	<select id="likeCheck" resultType="int">
	select count(*) from boardlike where s_seq = #{s_seq} and m_id=#{m_id}
	</select>
	
	<!-- max -->
	<select id="maxLike" resultType="int">
		SELECT MAX(like_number) + 1 FROM like;
	</select>
	
	<!-- insert 좋아요 -->
	<insert id="insertLike">
		insert into boardlike(s_seq, m_id)
		values( #{s_seq}, #{m_id})
	</insert>
	
	<!-- 게시물 추천수 업데이트 -->
	<update id="updateLike" parameterType="int">
	update styletab set 
	s_like = s_like+1
	where s_seq = #{s_seq}
	</update>
	
	<!-- 게시물 추천수 취소 -->
	<update id="updateLikeCancel" parameterType="int">
	update styletab set 
	s_like = s_like-1
	where s_seq = #{s_seq}
	</update>
	
	<!-- 게시글 추천 시 Check를 1로 만들어서 중복방지-->
	<update id="updateLikeCheck">
	update boardlike set likeCheck = 1
	where s_seq = #{s_seq} and m_id = #{m_id}
	</update>
	
	<!-- 게시글 추천취소 시 다시 0  -->
	<update id="updateLikeCheckCancel">
	update boardlike set likeCheck = 0
	where s_seq = #{s_seq} and m_id = #{m_id}
	</update>
	
	<!-- 게시글 추천취소 시 delete -->
	<delete id="deleteLike">
	delete from boardlike where s_seq = #{s_seq} and m_id = #{m_id}
	</delete>
	
	<!-- 상세페이지 좋아요 고정 -->
	<select id="likeCheck_main" resultType="int">
	select count(*) from boardlike where m_id = #{m_id} and s_seq = #{s_seq}
	</select>
</mapper>

